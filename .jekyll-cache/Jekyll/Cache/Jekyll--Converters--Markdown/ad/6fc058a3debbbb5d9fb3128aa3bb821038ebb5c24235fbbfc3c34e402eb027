I" ö<p>ì˜¤ëŠ˜ì€ ìƒˆë¡œ ê°€ì…í•œ kaggle ìŠ¤í„°ë””ì—ì„œ ë°œí‘œì¤€ë¹„ë¥¼ í•˜ë©´ì„œ ê³µë¶€í•œ ë‚´ìš©ì„ ì •ë¦¬í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.</p>

<p>ì£¼ì œëŠ” kaggleì˜ Pawpularity Contestì´ë©°,  ë§í¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>kaggleì˜ ì£¼ì œ ì‚¬ì´íŠ¸</li>
</ul>

<ul>
  <li>ë¶„ì„í•  ì½”ë“œ ë§í¬</li>
</ul>

<p>&lt; ëª©ì°¨ &gt;</p>

<ul>
  <li>ì‚¬ì „ì§€ì‹
    <ul>
      <li>ì´ë¯¸ì§€ ì„ë² ë”©</li>
      <li>Rapids SVR</li>
      <li>Finetuned models</li>
      <li>StatifiedKFold</li>
    </ul>
  </li>
  <li>ì½”ë“œ ë¶„ì„</li>
</ul>

<h3 id="0-ì†Œê°œë¼-í•˜ê³ -ì•½ì¹˜ê¸°ë¼ê³ -ì´í•´í•œë‹¤">0. ì†Œê°œ(ë¼ í•˜ê³  ì•½ì¹˜ê¸°ë¼ê³  ì´í•´í•œë‹¤)</h3>

<ul>
  <li>ì•„íŒ ìŒ!</li>
  <li>ê²°ë¡  -&gt; ë‹¤ëª»í–ˆìŒ!</li>
  <li>ì–´ì°¨í”¼ ë‹¤ë“¤ ì½”ë“œ í•œë²ˆ ë³¸ë‹¤ê³  ë°”ë¡œ ëª»ì“°ìë‚˜?!(ë‹¹ë‹¹) ì „ ê·¸ë˜ìš”!ã…‹ã…‹ã…‹ã…‹</li>
</ul>

<p>ì´ë²ˆ ë°œí‘œì˜ ëª©í‘œ</p>

<ul>
  <li>í›„ì— kaggleì´ë‚˜ ìµìŠ¤ë…¸ë“œë¥¼ ì§„í–‰í•  ë•Œ, ì´ëŸ° ì•„ì´ë””ì–´ê°€ ìˆë”ë¼ í•˜ëŠ” ì•„ì´ë””ì–´ë§Œì´ë¼ë„ ì¤ì¤í•´ê°€ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤ :&gt;</li>
  <li>ê°€ë” ë³´ì´ëŠ” íŒŒì´ì¬ ê¸°ë²•ë“¤ ì¤ì¤í•´ê°€ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤ mapì´ë¼ë˜ì§€ lambdaë¼ë˜ì§€.</li>
  <li>ì½”ë“œ ì´í•´ëŠ” ëª»í•˜ì…”ë„ ë©ë‹ˆë‹¤! ì €ë„ ëª»í–ˆê±°ë“ ìš”^^,,,</li>
</ul>

<p><a href="https://petfinder.my/">PetFinder.my</a> ëŠ” 180,000ë§ˆë¦¬ ì´ìƒì˜ ë™ë¬¼ê³¼ 54,000ë§ˆë¦¬ê°€ í–‰ë³µí•˜ê²Œ ì…ì–‘ëœ ë§ë ˆì´ì‹œì•„ ìµœê³ ì˜ ë™ë¬¼ ë³µì§€ í”Œë«í¼ì…ë‹ˆë‹¤. PetFinderëŠ” ë™ë¬¼ ì• í˜¸ê°€, ë¯¸ë””ì–´, ê¸°ì—… ë° ê¸€ë¡œë²Œ ì¡°ì§ê³¼ ê¸´ë°€í•˜ê²Œ í˜‘ë ¥í•˜ì—¬ ë™ë¬¼ ë³µì§€ë¥¼ ê°œì„ í•©ë‹ˆë‹¤.</p>

<p>í˜„ì¬ PetFinder.myëŠ” ê¸°ë³¸ <a href="https://petfinder.my/cutenessmeter">ê·€ì—¬ì›€ ì¸¡ì •ê¸°</a> ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• ì™„ ë™ë¬¼ ì‚¬ì§„ì˜ ìˆœìœ„ë¥¼ ë§¤ê¹ë‹ˆë‹¤. ìˆ˜ì²œ ê°œì˜ ì• ì™„ ë™ë¬¼ í”„ë¡œí•„ì˜ ì„±ëŠ¥ê³¼ ë¹„êµí•˜ì—¬ ì‚¬ì§„ êµ¬ì„± ë° ê¸°íƒ€ ìš”ì†Œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. ì´ ê¸°ë³¸ ë„êµ¬ëŠ” ìœ ìš©í•˜ì§€ë§Œ ì•„ì§ ì‹¤í—˜ ë‹¨ê³„ì— ìˆìœ¼ë©° ì•Œê³ ë¦¬ì¦˜ì„ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220211190235834.png" alt="image-20220211190235834" /></p>

<p><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220211190315705.png" alt="image-20220211190315705" /></p>

<h1 id="1-ì´ë¯¸ì§€-ì„ë² ë”©ì´ë€-image-embedding">1. ì´ë¯¸ì§€ ì„ë² ë”©ì´ë€? image Embedding</h1>

<h3 id="ì„ë² ë”©-embeddingì´ë€">ì„ë² ë”© Embeddingì´ë€?</h3>

<p>ë¨¸ì‹ ëŸ¬ë‹ì˜ í•µì‹¬ì€ ë°ì´í„°ì—ì„œ íŒ¨í„´ì„ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤. ë¨¸ì‹ ëŸ¬ë‹ì€ ë°ì´í„°ì˜ íŠ¹ì§•ìœ¼ë¡œë¶€í„° ë°ì´í„°ì˜ íŒ¨í„´ì„ ì°¾ì•„ ìœ ì‚¬ ë°ì´í„°ë¥¼ ë½‘ì•„ë‚´ê±°ë‚˜ ë¶„ë¥˜í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ, <strong>ë°ì´í„°ëŠ” ìš°ë¦¬ê°€ ì ì ˆí•œ íŠ¹ì§•ì„ ì°¾ë„ë¡ êµ¬ì¡°í™”ë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</strong> ì´ëŸ¬í•œ ê²½ìš° êµ¬ì¡°í™”ë˜ìˆì§€ ì•Šì€ ë°ì´í„°ì˜ íŠ¹ì§•ì„ ë‚˜íƒ€ë‚´ëŠ” ë²¡í„°ê°€ í•„ìš”í•œë° ì´ëŸ¬í•œ ë²¡í„°ë¥¼ <strong><em>ì„ë² ë”© ë²¡í„°</em></strong> ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.</p>

<p><strong>ê³ ì°¨ì›ì˜ ì •ë³´ë¥¼ ì €ì°¨ì›ìœ¼ë¡œ ë³€í™˜í•˜ë©´ì„œ í•„ìš”í•œ ì •ë³´ë§Œ ì„ë² ë”© ë²¡í„°ì— ë³´ì¡´í•˜ëŠ” ê²ƒì„ ì„ë² ë”©</strong>ì´ë¼ê³  í•©ë‹ˆë‹¤. ì„ë² ë”© ê³¼ì •ì„ í†µí•´ ì»´í“¨í„°ëŠ” ë°ì´í„°ì— ëŒ€í•œ ì €ì°¨ì› ì„ë² ë”© ë²¡í„°ë¥¼ ìƒì‚°í•˜ê³  ì´ë¥¼ í†µí•´ ìƒˆë¡œìš´ ë°ì´í„°ì— ëŒ€í•œ ì˜ˆì¸¡ì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<p>ë‹¤ìŒ ì˜ˆë¥¼ í†µí•´ ì‰½ê²Œ ì´í•´í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><img src="../images/pages/image-20220209112930636.png" alt="image-20220209112930636" /></p>

<p>ìœ„ì™€ ê°™ì´ ë²”ì£¼í˜• ë°ì´í„°ê°€ ìˆë‹¤ê³  í• ë•Œ, IDì—ëŠ” ì•„ë¬´ ì˜ë¯¸ê°€ ì—†ê¸° ë•Œë¬¸ì— ì´ ë°ì´í„°ë¥¼ í•™ìŠµí•˜ê¸° ìœ„í•´ì„  ë‹¤ë¥¸ ì „ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë³´í†µ ì¼ë°˜ì ì¸ ë°©ë²•ì€ one-hot-encodingì…ë‹ˆë‹¤.</p>

<p><img src="../images/pages/image-20220209113257816.png" alt="image-20220209113257816" /></p>

<p>ìœ„ì˜ ë³€í™˜ëœ ë²¡í„° ê°’ì„ ì´ìš©í•˜ì—¬ ì°¸ì¹˜ê¹€ì¹˜ì°Œê°œì™€ ë‹¤ë¥¸ ë©”ë‰´ ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<p><img src="../images/pages/image-20220209113310297.png" alt="image-20220209113310297" /></p>

<p>ê¹€ì¹˜ì°Œê°œ ì¢…ë¥˜ê°€ ì°¸ì¹˜ì´ˆë°¥ê³¼ ëœì¥ì°Œê°œì™€ëŠ” ë‹¤ë¥¼í…ë° ì „ë¶€ ê±°ë¦¬ê°€ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ì´ëŸ° ê²½ìš°, ë©”ë‰´ ì¶”ì²œì‹œìŠ¤í…œì—ì„œ ì–´ì œ ì°¸ì¹˜ê¹€ì¹˜ì°Œê°œë¥¼ ë¨¹ì–´ë„ ë¹„ìŠ·í•œ ìƒê³ ê¸° ê¹€ì¹˜ì°Œê°œë¥¼ ì¶”ì²œí•´ì£¼ê²Œ ë©ë‹ˆë‹¤.</p>

<p>ì„ë² ë”©ì„ ì ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë³€í™˜ë˜ëŠ” ë²¡í„°ì˜ ì°¨ì›ì€ 3ì°¨ì›ìœ¼ë¡œ ì •í•˜ê³  ê°ê° ì°Œê°œ ê°•í•¨ ì •ë„, ê³ ê¸° ì„ í˜¸ë„, ê±´ê°•í•œ ì •ë„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤ê³  í•©ì‹œë‹¤.</p>

<p><img src="../images/pages/image-20220209113511472.png" alt="image-20220209113511472" /></p>

<p>ì°¸ì¹˜ê¹€ì¹˜ì°Œê°œì™€ ë‹¤ë¥¸ ë©”ë‰´ ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<p><img src="../images/pages/image-20220209113605829.png" alt="image-20220209113605829" /></p>

<p>ë³µí•©ì ì¸ ëª¨ë“  íŠ¹ì„±ì´ í†µí•©ë˜ì–´ìˆëŠ” ê³ ì°¨ì› ë°ì´í„°ë¥¼ ê°ê°ì˜ íŠ¹ì„±ìš”ì†Œë¥¼ ë–¼ì„œ ì €ì°¨ì› ë²¡í„°ë¥¼ ë§Œë“œëŠ” ê³¼ì •ì„ ì„ë² ë”©ì´ë¼ê³  í•©ë‹ˆë‹¤.</p>

<ul>
  <li>https://simonezz.tistory.com/43</li>
  <li>https://velog.io/@dongho5041/%EB%94%A5%EB%9F%AC%EB%8B%9D-%EC%9D%B8%EA%B3%B5%EC%8B%A0%EA%B2%BD%EB%A7%9D%EC%9D%98-Embedding%EC%9D%B4%EB%9E%80</li>
  <li>ì„ë² ë”© ì¶”ì²œ ê¸€ : https://blog.linewalks.com/archives/6408</li>
</ul>

<h3 id="ì´ë¯¸ì§€-ì„ë² ë”©">ì´ë¯¸ì§€ ì„ë² ë”©</h3>

<p>ì¡ì§€ í‘œì§€ ì´ë¯¸ì§€ë¥¼ ë³´ê³  ë¹„ìŠ·í•œ ì¡ì§€ë¥¼ ì°¾ëŠ”ë‹¤ê³  ê°€ì •í•  ë•Œ, pixel-by-pixelë¡œ ìœ ì‚¬ì„±ì„ ì¸¡ì •í•˜ëŠ” ê²ƒì€ ì˜ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì´ëŸ° ê²½ìš°, ì„ë² ë”©ì„ ì¶”ì¶œí•˜ë©´ semantic informationì„ í†µí•´ íš¨ê³¼ì ìœ¼ë¡œ ì¸¡ì •í•  ìˆ˜ ìˆë‹¤.</p>

<h1 id="2-transfer-learning">2. Transfer learning</h1>

<p>ë§ì€ ì‚¬ëŒë“¤ì´ ML ëª¨ë¸ë“¤ì„ ì´ìš©í•´ì„œ ê³ ì°¨ì›ì´ê±°ë‚˜ ë³µì¡í•˜ê±°ë‚˜ êµ¬ì¡°í™”ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì„ë² ë”©ìœ¼ë¡œ ì¸ì½”ë”©í•˜ê³ ìí•œë‹¤.</p>

<p>í…ìŠ¤íŠ¸ë‚˜ ì´ë¯¸ì§€, ê·¸ ì™¸ ë°ì´í„°ë“¤ì„ ì¸ì½”ë”©í•˜ê¸° ìœ„í•´ <strong>ë¯¸ë¦¬ íŠ¸ë ˆì´ë‹ëœ ë„¤íŠ¸ì›Œí¬</strong>ë¥¼ ì´ìš©í•˜ì—¬ ì„ë² ë”© ì‹œí‚¤ëŠ” ê²ƒì„ <strong><em>transfer learning</em></strong>ì´ë¼ í•œë‹¤.</p>

<p>ê·¸ëŸ¬ë¯€ë¡œ, <strong>Transfer Learning</strong>ì„ í†µí•´ ì§€ì‹ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼, íŠ¸ë ˆì´ë‹ ì‹œí‚¤ëŠ” ì‹œê°„ì„ ëŒ€í­ ì¤„ì¼ ìˆ˜ ìˆë‹¤.</p>

<p>ì„ë² ë”©ì€ ëª¨ë¸ ë‹¤ìŒë°©ë²•ìœ¼ë¡œ ì ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤. <strong>ì„ë² ë”©ì„ ì¸í’‹ feature vectorsë¡œ ì‚¬ìš©</strong>í•˜ëŠ” ê²ƒì´ë‹¤. Base input featruesë¥¼ ë¯¸ë¦¬ íŠ¸ë ˆì´ë‹ëœ ì„ë² ë”©ì— ìŒ“ì•„ì„œ ì¸í’‹ feature vectorë¥¼ í˜•ì„±í•  ìˆ˜ ìˆë‹¤. í‚¤í¬ì¸íŠ¸ëŠ” ì´ëŸ¬í•œ ì„ë² ë”©ì´ íŠ¸ë ˆì´ë‹ì´ ê°€ëŠ¥í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰, ëª¨ë¸ì„ íŠ¸ë ˆì´ë‹ì‹œí‚¬ ë•Œ íŠœë‹ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220209115041484.png" alt="image-20220209115041484" /></p>

<ul>
  <li>https://simonezz.tistory.com/44</li>
</ul>

<h1 id="3-rapids-svr">3. RAPIDs SVR</h1>

<p>ë˜í”¼ì¦ˆ(Rapids)ëŠ” ì—”ë¹„ë””ì•„ì—ì„œ ê°œë°œí•˜ê³  ê´€ë¦¬í•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ GPU ê°€ì† ë°ì´í„° ê³¼í•™ ë° ë¨¸ì‹ ëŸ¬ë‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. Panda, Scikit-learn, numpy ë“±ê³¼ ê°™ì€ ê¸°ì¡´ì˜ ë§ì€ CPU ë„êµ¬ì™€ í˜¸í™˜ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë§ì€ ë°ì´í„° ê³¼í•™ ë° ê¸°ê³„ í•™ìŠµ ì‘ì—…ì„ ëŒ€ê·œëª¨ ê°€ì†í™”í•  ìˆ˜ ìˆìœ¼ë©°, ì¢…ì¢… 100X ë˜ëŠ” ê·¸ ì´ìƒì˜ ë¹„ìœ¨ë¡œ ê°€ì†í™”í•  ìˆ˜ ìˆëŠ” íˆ´ì…ë‹ˆë‹¤. RapidsëŠ” ì—¬ì „íˆ ê°œë°œ ì¤‘ì— ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<p>https://rapids.ai/</p>

<h1 id="4-finetuned-models">4. Finetuned models</h1>

<ul>
  <li>
    <p>fine tuningì´ë€?</p>

    <p>- <strong>ê¸°ì¡´ì— í•™ìŠµë˜ì–´ì ¸ ìˆëŠ” ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì•„í‚¤í…ì³ë¥¼ ìƒˆë¡œìš´ ëª©ì (ë‚˜ì˜ ì´ë¯¸ì§€ ë°ì´í„°ì— ë§ê²Œ)ë³€í˜•í•˜ê³  ì´ë¯¸ í•™ìŠµëœ ëª¨ë¸ Weightsë¡œ ë¶€í„° í•™ìŠµì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ë²•</strong>ì„ ë§í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>ì˜ˆì‹œ</p>

    <p>ê³ ì–‘ì´ì™€ ê°œ ë¶„ë¥˜ê¸°ë¥¼ ë§Œë“œëŠ”ë° ë‹¤ë¥¸ ë°ì´í„°ë¡œ í•™ìŠµëœ ëª¨ë¸(VGG16, ResNet ë“±) ì„ ê°€ì ¸ë‹¤ ì“°ëŠ” ê²½ìš°</p>

    <p>VGG16 ëª¨ë¸ì˜ ê²½ìš° 1000 ê°œì˜ ì¹´í…Œê³ ë¦¬ë¥¼ í•™ìŠµì‹œì¼°ê¸° ë•Œë¬¸ì— ê³ ì–‘ì´ì™€ ê°œ, 2ê°œì˜ ì¹´í…Œê³ ë¦¬ë§Œ í•„ìš”í•œ ìš°ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”ë° ëª¨ë“  ë ˆì´ì–´ë¥¼ ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.</p>

    <p>ë”°ë¼ì„œ ê°€ì¥ ì‰½ê²Œ ì´ìš©í•˜ë ¤ë©´ ë‚´ ë°ì´í„°ë¥¼ í•´ë‹¹ ëª¨ë¸ë¡œ ì˜ˆì¸¡(predict)í•˜ì—¬ ë³´í‹€ë„¥ í”¼ì³ë§Œ ë½‘ì•„ë‚´ê³ , ì´ë¥¼ ì´ìš©í•˜ì—¬ í’€ë¦¬ ì»¤ë„¥í‹°ë“œ ë ˆì´ì–´(Fully-connected layer) ë§Œ í•™ìŠµì‹œì¼œì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì·¨í•˜ë©´ ë©ë‹ˆë‹¤.</p>

    <ul>
      <li>ë³´í‹€ë„¥ í”¼ì²˜ : ê°€ì¥ ë§ˆì§€ë§‰ CNN ë¸”ë¡ì„ ì˜ë¯¸(ëª¨ë¸ì—ì„œ ê°€ì¥ ì¶”ìƒí™”ëœ í”¼ì²˜)í•˜ë©°, Fully connected layer ì§ì „ì˜ CNNë¸”ë¡ì˜ ê²°ê³¼ë¥¼ ì˜ë¯¸í•œë‹¤.</li>
    </ul>
  </li>
</ul>

<p>ì¶œì²˜: https://eehoeskrap.tistory.com/186 [Enough is not enough]</p>

<h1 id="5-stratifiedkfold">5. Stratifiedkfold</h1>

<ul>
  <li>
    <p>k-fold : í•™ìŠµë°ì´í„°ì…‹ê³¼ ê²€ì¦ ë°ì´í„° ì…‹ì„ ë‚˜ëˆ„ì–´ì„œ ì§„í–‰í•˜ëŠ” ê²ƒ</p>
  </li>
  <li>
    <p>startifiedkfold : ë¶ˆê· í˜•í•œ datasetì¼ ê²½ìš° ì‚¬ìš©í•˜ëŠ” kfold ë°©ë²•</p>

    <ul>
      <li>
        <p>kê°œì˜ foldë¥¼ ë¶„í• í•œ ì´í›„ì—ë„ ì „ì²´ í›ˆë ¨ ë°ì´í„°ì˜ class ë¹„ìœ¨ê³¼ ê° foldê°€ ê°€ì§€ê³  ìˆëŠ” class ë¹„ìœ¨ì„ ë§ì¶°ì¤ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>íŒŒë¼ë¯¸í„°</p>

        <p>n_splits : Foldì˜ ê°œìˆ˜ k ê°’ (ì •ìˆ˜í˜•, ê¸°ë³¸ : 5)</p>

        <p>shuffle : ë°ì´í„°ë¥¼ ìª¼ê°¤ ë•Œ ì„ì„ì§€ ìœ ë¬´ (True/False, ê¸°ë³¸ : False)</p>

        <p>random_state : ë‚œìˆ˜ ì„¤ì •</p>

        <p>https://8888-wpkwtqrc21bbba6iczeu3g152.e.prod.connect.ainize.ai/notebooks/aiffel/Untitled.ipynb</p>

        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">features</span> <span class="o">=</span> <span class="n">iris</span><span class="p">.</span><span class="n">data</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">iris</span><span class="p">.</span><span class="n">target</span>
<span class="n">dt_clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    
<span class="n">iris_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">iris</span><span class="p">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">iris_df</span><span class="p">[</span><span class="s">'label'</span><span class="p">]</span><span class="o">=</span><span class="n">iris</span><span class="p">.</span><span class="n">target</span>
    
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">n_iter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">val_index</span> <span class="ow">in</span> <span class="n">skf</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">iris_df</span><span class="p">,</span> <span class="n">iris_df</span><span class="p">[</span><span class="s">'label'</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">train_index</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">val_index</span><span class="p">,</span> <span class="s">'</span><span class="se">\n\n\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">n_iter</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="n">label_train</span> <span class="o">=</span> <span class="n">iris_df</span><span class="p">[</span><span class="s">'label'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
    <span class="n">label_val</span> <span class="o">=</span> <span class="n">iris_df</span><span class="p">[</span><span class="s">'label'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_index</span><span class="p">]</span>
        
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="n">val_index</span><span class="p">]</span>
    <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_val</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="n">val_index</span><span class="p">]</span>
    <span class="n">dt_clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s">'###### cross validation ##### : {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">n_iter</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'êµì°¨ ê²€ì¦ ì •í™•ë„ : {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">Y_val</span><span class="p">,</span> <span class="n">dt_clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">))))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'í•™ìŠµ ë ˆì´ë¸” ë°ì´í„° ë¶„í¬ </span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">label_train</span><span class="p">.</span><span class="n">value_counts</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'ê²€ì¦ ë ˆì´ë¸” ë°ì´í„° ë¶„í¬ </span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">label_val</span><span class="p">.</span><span class="n">value_counts</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n\n</span><span class="s">'</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>ì½”ë“œ : https://guru.tistory.com/35</p>
  </li>
  <li>
    <p>ì½”ë“œ : https://jinnyjinny.github.io/deep%20learning/2020/04/02/Kfold/</p>
  </li>
  <li>
    <p>ì´ë¡  : https://steadiness-193.tistory.com/287</p>
  </li>
</ul>

<h1 id="5-ì½”ë“œ-ë¶„ì„">5. ì½”ë“œ ë¶„ì„</h1>

<ul>
  <li>OpenAI CLIP</li>
</ul>

<p><img src="../images/pages/CLIP.png" alt="CLIP.png" /></p>

<p>CLIP(Contrastive Language-Image Pre-Training)ì€ ë‹¤ì–‘í•œ (ì´ë¯¸ì§€, í…ìŠ¤íŠ¸) ìŒìœ¼ë¡œ í›ˆë ¨ëœ ì‹ ê²½ë§ì…ë‹ˆë‹¤. (ì´ë¯¸ì§€, ë¬¼ì²´ ë¶„ë¥˜) ë°ì´í„° ëŒ€ì‹  (ì´ë¯¸ì§€, í…ìŠ¤íŠ¸)ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ìˆ˜ì‘ì—… labeling ì—†ì´ ì›¹ í¬ë¡¤ë§ì„ í†µí•´ ìë™ìœ¼ë¡œ ì´ë¯¸ì§€ì™€ ê·¸ì— ì—°ê´€ëœ ìì—°ì–´ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ì—¬ 4ì–µê°œì˜ (ì´ë¯¸ì§€-í…ìŠ¤íŠ¸) ìŒì„ ê°€ì§„ ê±°ëŒ€ ë°ì´í„°ì…‹ì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<p>ì‘ì—…ì— ëŒ€í•œ ì§ì ‘ ìµœì í™” ì—†ì´ ì£¼ì–´ì§„ ì´ë¯¸ì§€ì—ì„œ ê°€ì¥ ê´€ë ¨ì„± ë†’ì€ í…ìŠ¤íŠ¸ ìŠ¤ë‹ˆí«ì„ ì˜ˆì¸¡í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CLIPì˜ ì„±ëŠ¥ì€ ResNet50ì •ë„ë¡œ ë›°ì–´ë‚œ í¸ì— ì†í•©ë‹ˆë‹¤.</p>

<p>CLIPì€ ImageNetì˜ ëŒ€ìš©ëŸ‰ ë°ì´í„°ì…‹ìœ¼ë¡œ ë¯¸ë¦¬ í•™ìŠµì‹œí‚¨ ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ì ¸ì™€ ì•½ê°„ì˜ ì¶”ê°€ì ì¸ í•™ìŠµë§Œ ìˆ˜í–‰í•˜ì—¬ë„ ì›í•˜ëŠ” taskì—ì„œ í›Œë¥­í•œ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ìˆì–´, ì—¬ëŸ¬ ë¶„ì•¼ì—ì„œ í™œë°œíˆ í™œìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

<p>CLIP ì œì‘ì ì„¤ëª…  : https://github.com/openai/CLIP</p>

<ul>
  <li>https://inforience.net/2021/02/09/clip_visual-model_pre_training/</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>train['path'] = train['Id'].map(lambda x: '../input/petfinder-pawpularity-score/train/'+x+'.jpg')
</code></pre></div></div>

<ul>
  <li>
    <p>trainê³¼ test ë°ì´í„°ì— path ì»¬ëŸ¼ ì¶”ê°€.</p>

    <p>path+id.jpg ê°’ì„ ë„£ì–´ì¤Œ.</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if test.shape[0]&lt;10:
    test = pd.concat([
        test, test, test, test, test, 
    ])
    test = test.reset_index(drop=True)
</code></pre></div></div>

<ul>
  <li>
    <p>ê¸°ì¡´ test ë°ì´í„°ì˜ ìˆ˜ë¥¼ ëŠ˜ë ¤ì¤Œ.</p>

    <p>if ë¸”ë¡ì˜ ì—­í• ì€ ê¸°ì¡´ì˜ testë°ì´í„° ìˆ˜ë¥¼ ëŠ˜ë ¤ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤.
8 + 8 + 8 + 8 + 8ë¡œ, ê·¸ëŒ€ë¡œ testë°ì´í„°ë¥¼ ì—°ì¥ì‹œì¼œì£¼ì—ˆìŠµë‹ˆë‹¤.
(ê·¼ë° ê°™ì€ ë°ì´í„°ê°’ì´ê³  index columë§Œ ë‹¬ë¼ì§€ëŠ”ë° êµ³ì´..? ì™œ..?)</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>train['bins'] = (train['Pawpularity']//5).round()

train['fold0'] = -1
skf = StratifiedKFold(n_splits = 20, shuffle=True, random_state = 1)
for i, (_, test_index) in enumerate(skf.split(train.index, train['bins'])):
    train.iloc[test_index, -1] = i

train['fold0'] = train['fold0'].astype('int')
gc.collect()

train.groupby(['fold0'])['Pawpularity'].agg(['mean','std','count'])
</code></pre></div></div>

<ul>
  <li>
    <p>bins ì—´</p>

    <p>stratified K fold ë¼ë²¨ì„ 20ê°œë¡œ ë§ì¶°ì£¼ê¸°ë„ í•˜ê³ , stratified K foldì—ì„œ pawpularityì˜ ë¼ë²¨ë§ ë¹„ìœ¨ì„ ë§ì¶°ì£¼ê¸° ìœ„í•´ ì‚¬ìš© (1-100 ê¹Œì§€ì˜ ì •ë‹µë¼ë²¨ ì¡´ì¬, //5 í•˜ë©´ 20ê°œë¡œ ë‚˜ë‰˜ì–´ì§)</p>
  </li>
  <li>StratifiedKFold
    <ul>
      <li>ë¶ˆê· í˜•í•œ datasetì¼ ê²½ìš° ì‚¬ìš©í•˜ëŠ” kfold ë°©ë²•</li>
      <li>kê°œì˜ foldë¥¼ ë¶„í• í•œ ì´í›„ì—ë„ ì „ì²´ í›ˆë ¨ ë°ì´í„°ì˜ class ë¹„ìœ¨ê³¼ ê° foldê°€ ê°€ì§€ê³  ìˆëŠ” class ë¹„ìœ¨ì„ ë§ì¶°ì¤ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
    <p>enumerateë¬¸</p>

    <p>ë‚˜ë„ ëª¨ë¥´ê² ìŒ.</p>
  </li>
  <li>
    <p>astype</p>

    <p>train[â€˜fold0â€™] ì»¬ëŸ¼ì„ intí˜•ìœ¼ë¡œ ë³€í™˜</p>
  </li>
  <li>
    <p>groupby</p>

    <p><code class="language-plaintext highlighter-rouge">train.groupby(['fold0'])['Pawpularity'].agg(['mean','std','count'])</code></p>

    <p>foldë§ˆë‹¤ pawpularityì˜ mean(í‰ê· ), std(í‘œì¤€í¸ì°¨), count(ê°œìˆ˜)ê°’ì„ ë‚˜íƒ€ë‚´ì¤ë‹ˆë‹¤.</p>

    <p>foldë§ˆë‹¤ ì œëŒ€ë¡œ stratified k fold ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì“´ë“¯</p>

    <p><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220209202030083.png" alt="image-20220209202030083" /></p>
  </li>
</ul>

<h2 id="timm-library">timm library</h2>

<p>PyTorch Image Models(timm)ëŠ” ì´ë¯¸ì§€ ëª¨ë¸, ë ˆì´ì–´, ìœ í‹¸ë¦¬í‹°, ì˜µí‹°ë§ˆì´ì €, ìŠ¤ì¼€ì¤„ëŸ¬, ë°ì´í„° ë¡œë”/ì¦ê°• ë° ì°¸ì¡° êµìœ¡/ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ì˜ ëª¨ìŒìœ¼ë¡œ, ImageNet êµìœ¡ ê²°ê³¼ë¥¼ ì¬í˜„í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ SOTA ëª¨ë¸ì„ í†µí•©í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.</p>

<p><img src="../images/pages/image-20220209011128949.png" alt="image-20220209011128949" /></p>

<p>https://github.com/rwightman/pytorch-image-models#introduction</p>

<blockquote>
  <p>ë³´ë‹¤ì‹œí”¼ timm ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‚¬ì „ í›ˆë ¨ëœ ëª¨ë¸ ì•„í‚¤í…ì²˜ê°€ 575ê°œ ìˆìŠµë‹ˆë‹¤.Â¶</p>

  <p>ì†”ë£¨ì…˜ì˜ ì²« ë²ˆì§¸ ë¶€ë¶„ì€ ê¸°ë³¸ì ìœ¼ë¡œ í•´ë‹¹ ëª¨ë¸ì˜ ë§ˆì§€ë§‰ ê³„ì¸µì—ì„œ íŠ¹ì§•ì„ ì¶”ì¶œí•˜ê³  ì¶”ì¶œëœ íŠ¹ì§•ì— ëŒ€í•´ SVRì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤</p>

  <p>timmì˜ ëª¨ë¸ë“¤ì€ ëŒ€ë¶€ë¶„ Imagenetì—ì„œ 1000ê°œì˜ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í›ˆë ¨ë˜ê¸° ë•Œë¬¸ì— ì¶œë ¥ ëª¨ì–‘ì€ ëª¨ë¸ë§ˆë‹¤ 1000ê°œì…ë‹ˆë‹¤.
ëª¨ë“  575 ëª¨ë¸ì—ì„œ ê¸°ëŠ¥ì„ ì¶”ì¶œí•˜ëŠ” ê²ƒì€ íŠ¹íˆ ì œì¶œ ì‹œê°„ì´ 9ì‹œê°„ì´ë¼ëŠ” ì ì„ ê³ ë ¤í•  ë•Œ ë§ë„ ì•ˆë˜ê³  ìƒìƒë„ í•  ìˆ˜ ì—†ëŠ” ì¼ì´ë‹¤. ë”°ë¼ì„œ RMSE ì¸¡ë©´ì—ì„œ ì„±ëŠ¥ì´ ì¢‹ì€ ëª¨ë¸ì˜ í•˜ìœ„ ì§‘í•©ì„ ì°¾ì•„ë³´ì•˜ìŠµë‹ˆë‹¤.</p>

  <p>ì´ë¥¼ ìœ„í•´ RMSE í í´ë¼ì´ë° ì•Œê³ ë¦¬ì¦˜ì— ë”°ë¼ ì „ì§„ ëª¨ë¸ ì„ íƒ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í–ˆë‹¤. í•œ ëª¨ë¸ë¶€í„° ì‹œì‘í•˜ì—¬ RMSE ì„±ëŠ¥ í–¥ìƒì„ ì¤‘ì§€í•  ë•Œê¹Œì§€ ëª¨ë¸ì„ ê³„ì† ì¶”ê°€í•©ë‹ˆë‹¤.</p>

  <p>ì´ì œ Imagenet ì‚¬ì „ í›ˆë ¨ëœ ëª¨ë¸ ê¸°ëŠ¥ ì¶”ì¶œì„ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.
ì´ ì†”ë£¨ì…˜ì— ì‚¬ìš©ëœ ì „ì§„ ëª¨ë¸ ì„ íƒ ì•Œê³ ë¦¬ì¦˜ì— ì˜í•´ ë°œê²¬ëœ ì‚¬ì „ êµìœ¡ëœ ëª¨ë¸ì€ ìœ„ì— ë‚˜ì—´ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">modelpath</span> <span class="o">=</span> <span class="p">{</span> <span class="n">m</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="s">'../input/pytorch-pretrained-0/*.pt'</span><span class="p">)</span><span class="o">+</span><span class="n">glob</span><span class="p">(</span><span class="s">'../input/pytorch-pretrained-1/*.pt'</span><span class="p">)</span><span class="o">+</span><span class="n">glob</span><span class="p">(</span><span class="s">'../input/pytorch-pretrained-2/*.pt'</span><span class="p">)</span><span class="o">+</span><span class="n">glob</span><span class="p">(</span><span class="s">'../input/pytorch-pretrained-3/*.pt'</span><span class="p">)}</span>
<span class="n">modelpath</span>
</code></pre></div></div>

<p>str = ../input/pytorch-pretrained-0/resnetv2_101x1_bitm.pt ì¼ë•Œ,</p>

<p>str.split(â€˜/â€™) ì˜ ê²°ê³¼</p>

<blockquote>
  <p>[â€™..â€™, â€˜inputâ€™, â€˜pytorch-pretrained-0â€™, â€˜resnetv2_101x1_bitm.ptâ€™]</p>
</blockquote>

<p>str.split(â€˜/â€™)[-1] ì˜ ê²°ê³¼</p>

<blockquote>
  <p>â€˜resnetv2_101x1_bitm.ptâ€™</p>
</blockquote>

<p>str.split(â€˜/â€™)[-1].split(â€˜.â€™)ì˜ ê²°ê³¼</p>

<blockquote>
  <p>[â€˜resnetv2_101x1_bitmâ€™, â€˜ptâ€™]</p>
</blockquote>

<p>&lt; ì°¸ê³  &gt;</p>

<p><img src="../images/pages/image-20220209011713971.png" alt="image-20220209011713971" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># EMB TESTê°€ ë­˜ê¹Œ
</span><span class="n">EMB_TEST</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">arch</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    <span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="p">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">to</span><span class="p">(</span><span class="s">'cuda'</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">modelpath</span><span class="p">[</span><span class="n">arch</span><span class="p">]))</span>
    <span class="n">model</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>

    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">PawpularDataset</span><span class="p">(</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">base_path</span><span class="o">=</span><span class="s">'../input/petfinder-pawpularity-score/test/'</span><span class="p">,</span>
        <span class="n">modelcfg</span> <span class="o">=</span> <span class="n">resolve_data_config</span><span class="p">({},</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">),</span>
        <span class="n">aug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">BS</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">arch</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'tf_efficientnet_l2_ns'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">16</span>
    <span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BS</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="s">'cuda'</span><span class="p">)).</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">train_dataloader</span><span class="p">]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">EMB_TEST</span><span class="p">[</span><span class="n">arch</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
    
    <span class="k">print</span><span class="p">(</span> <span class="n">arch</span><span class="p">,</span> <span class="s">', Done in:'</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">starttime</span><span class="p">),</span> <span class="s">'s'</span> <span class="p">)</span>
    
    <span class="k">del</span> <span class="n">model</span><span class="p">,</span> <span class="n">res</span>
    <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span> <span class="c1"># PyTorch thing to clean RAM
</span>    <span class="n">gc</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="p">)</span>    
<span class="nb">len</span><span class="p">(</span><span class="n">EMB_TEST</span><span class="p">),</span> <span class="n">EMB_TEST</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>timm.create_model(arch, pretrained=False).to(â€˜cudaâ€™)
    <ul>
      <li>
        <p>timm.create_model</p>

        <blockquote>
          <p><code class="language-plaintext highlighter-rouge">timm</code> is a deep-learning library created by <a href="https://twitter.com/wightmanr">Ross Wightman</a> and is a collection of SOTA computer vision models, layers, utilities, optimizers, schedulers, data-loaders, augmentations and also training/validating scripts with ability to reproduce ImageNet training results.</p>
        </blockquote>

        <p>https://fastai.github.io/timmdocs/</p>

        <p>pretrained=falseì¸ ìƒíƒœë¡œ namesì˜ ê°ì²´ë“¤ì„ ë¶ˆëŸ¬ì™€ ëª¨ë¸ì„ ìƒì„±í•´ì¤ë‹ˆë‹¤. gpuë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ <code class="language-plaintext highlighter-rouge">.to('cuda')</code>ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>

        <p>ê·¸ë°–ì˜ gpuë¥¼ ì‚¬ìš©í•  ìˆ˜ìˆëŠ” ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

        <ul>
          <li>
            <p>x = torch.tensor([1., 2.], device=â€cudaâ€)</p>
          </li>
          <li>
            <p>x = torch.tensor([1., 2.]).cuda()</p>
          </li>
          <li>
            <p>https://y-rok.github.io/pytorch/2020/10/03/pytorch-gpu.html</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>load_state_dict(torch.load(modelpath[arch]))
    <ul>
      <li>load_state_dictëŠ” ê°€ì¤‘ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.</li>
      <li>
        <p>ìƒˆë¡œìš´ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œ í›„ì— ê°€ì¤‘ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¬ ê²½ìš°, pretrained =Falseë¥¼ ì£¼ê³ , load_state_dictë©”ì†Œë“œë¥¼ ì´ìš©í•´ ê°€ì¤‘ì¹˜ ê°’ì„ë¶ˆëŸ¬ì˜¤ê²Œ ë©ë‹ˆë‹¤.</p>
      </li>
      <li>https://tutorials.pytorch.kr/beginner/basics/saveloadrun_tutorial.html</li>
    </ul>
  </li>
  <li>model.eval()
    <ul>
      <li>
        <p>ì¶”ë¡ (inference)ì„ í•˜ê¸° ì „ì— <code class="language-plaintext highlighter-rouge">model.eval()</code> ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë“œë¡­ì•„ì›ƒ(dropout)ê³¼ ë°°ì¹˜ ì •ê·œí™”(batch normalization)ë¥¼ í‰ê°€ ëª¨ë“œ(evaluation mode)ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì¼ê´€ì„± ì—†ëŠ” ì¶”ë¡  ê²°ê³¼ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">.eval()</code> í•¨ìˆ˜ëŠ” evaluation ê³¼ì •ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•˜ëŠ” layerë“¤ì„ ì•Œì•„ì„œ off ì‹œí‚¤ë„ë¡ í•˜ëŠ” í•¨ìˆ˜ì´ë©°</p>

        <p>evaluation/validation ê³¼ì •ì—ì„  ë³´í†µ <code class="language-plaintext highlighter-rouge">model.eval()</code>ê³¼ <code class="language-plaintext highlighter-rouge">torch.no_grad()</code>ë¥¼ í•¨ê»˜ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>ì‚¬ìš© ë°©ë²• ê´€ë ¨ url : https://tutorials.pytorch.kr/beginner/basics/saveloadrun_tutorial.html</p>
      </li>
      <li>
        <p>eval ì´ ë¬´ì—‡ì¸ì§€ : https://stackoverflow.com/questions/60018578/what-does-model-eval-do-in-pytorch/60018731#60018731</p>
      </li>
      <li>
        <p>eval ì´ ë¬´ì—‡ì¸ì§€ : https://bluehorn07.github.io/2021/02/27/model-eval-and-train.html</p>
      </li>
    </ul>
  </li>
  <li>DataLoader(train_dataset, batch_size=BS, num_workers= 2, shuffle=False)
    <ul>
      <li>
        <p>dataloaderëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ ë°ì´í„° ë¡œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. num_workers ì— ì–‘ì˜ ì •ìˆ˜ë¥¼ ì„¤ì •í•˜ê²Œë˜ë©´, ì§€ì •ëœ ìˆ˜ì˜ ë¡œë” ì‘ì—…ì í”„ë¡œì„¸ìŠ¤ë¡œ ë©€í‹° í”„ë¡œì„¸ìŠ¤ ë°ì´í„° ë¡œë“œê°€ ì¼œì§‘ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>https://tutorials.pytorch.kr/beginner/basics/data_tutorial.html</p>
      </li>
    </ul>
  </li>
  <li>with torch.no_grad():
    <ul>
      <li>ìì›ì„ íšë“í•˜ê³  ì‚¬ìš© í›„ ë°˜ë‚©í•´ì•¼ í•˜ëŠ” ê²½ìš°ì— ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
      <li>í”„ë¡œì„¸ìŠ¤ : í˜„ì¬ ì‹¤í–‰ë˜ê³  ìˆëŠ” í”„ë¡œê·¸ë¨
        <ul>
          <li>ìì› : ê¸°ì–µì¥ì¹˜ Ramì´ë‚˜ í”„ë¡œì„¸ì„œ ë””ìŠ¤í¬ ë“±ì˜ í•˜ë“œì›¨ì–´ ì¥ì¹˜ë‚˜ ë©”ì‹œì§€, íŒŒì¼ë“±ì˜ ì†Œí”„íŠ¸ì›¨ì–´ ìš”ì†Œë“¤</li>
        </ul>
      </li>
      <li>https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&amp;blogId=wideeyed&amp;logNo=221653260516</li>
    </ul>
  </li>
</ul>

<p>Now its time to fit a GPU accelerated SVR using cuml<a href="https://www.kaggle.com/titericz/imagenet-embeddings-rapids-svr-finetuned-models/notebook#Now-its-time-to-fit-a-GPU-accelerated-SVR-using-cuml">Â¶</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">kfoldcol</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ind_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">kfoldcol</span><span class="p">]</span> <span class="o">!=</span> <span class="n">fold</span>
        <span class="n">ind_valid</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">kfoldcol</span><span class="p">]</span> <span class="o">==</span> <span class="n">fold</span>

</code></pre></div></div>

<ul>
  <li>ì´í•´ëª»í•¨ ^_^/</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">16.0</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s">'rbf'</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s">'numpy'</span><span class="p">)</span>
        <span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">TRAIN</span><span class="p">[</span><span class="n">ind_train</span><span class="p">],</span> <span class="n">train</span><span class="p">.</span><span class="n">Pawpularity</span><span class="p">[</span><span class="n">ind_train</span><span class="p">].</span><span class="n">clip</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>  <span class="p">)</span>

        <span class="n">ypredtrain_</span><span class="p">[</span><span class="n">ind_valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">TRAIN</span><span class="p">[</span><span class="n">ind_valid</span><span class="p">]),</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ypredtest_</span> <span class="o">+=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">TEST</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>
    <p>SVR</p>

    <p>Rapids SVRì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ì‰½ë„¤ìš”. cuml.svm íŒ¨í‚¤ì§€ì—ì„œ SVRì„ import í•´ì„œ ì‚¬ìš©í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>np.clip(array, min, max)</p>

    <p>arrayë‚´ì˜ elementì— ëŒ€í•˜ì—¬ minê°’ë³´ë‹¤ ì‘ì€ ê°’ë“¤ì„ minìœ¼ë¡œ ë°”ê¿”ì£¼ê³ , maxë³´ë‹¤ í° ê°’ì„ maxë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
  </li>
</ul>

<blockquote>
  <p>ì²«ì§¸, ê° ì•„í‚¤í…ì²˜ì— ëŒ€í•´ í•˜ë‚˜ì˜ SVRì„ ë…ë¦½ì ìœ¼ë¡œ ì¥ì°©í•©ë‹ˆë‹¤.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    
    <span class="n">TRAIN</span> <span class="o">=</span> <span class="n">EMB_TRAIN</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">TEST</span> <span class="o">=</span> <span class="n">EMB_TEST</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">TEST</span><span class="p">))</span> <span class="p">)</span>
    <span class="n">TRAIN</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">TRAIN</span><span class="p">)</span>
    <span class="n">TEST</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">TEST</span><span class="p">)</span>
    
    <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">ypredtest</span> <span class="o">=</span> <span class="n">fit_gpu_svr</span><span class="p">(</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">TEST</span><span class="p">,</span> <span class="s">'fold0'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">rmse</span><span class="p">(</span><span class="n">train</span><span class="p">.</span><span class="n">Pawpularity</span><span class="p">,</span><span class="n">ypredtrain</span><span class="p">),</span> <span class="n">col</span><span class="p">)</span>    
</code></pre></div></div>

<ul>
  <li>
    <p>StandartScaler()</p>

    <p><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220209213749442.png" alt="image-20220209213749442" style="zoom: 67%;" /> -&gt;<img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220209213757080.png" alt="image-20220209213757080" /></p>

    <ul>
      <li>
        <p>í‰ê·  0 , ë¶„ì‚° 1ë¡œ ì¡°ì •í•©ë‹ˆë‹¤</p>
      </li>
      <li>
        <p>ë³´í†µì˜ ì‹¸ì´í‚·ëŸ° í•¨ìˆ˜ë“¤ê³¼ ë¹„ìŠ·í•˜ê²Œ fit, transform, fit_transform ë‹¤ ì§€ì›í•©ë‹ˆë‹¤.</p>
      </li>
      <li>
        <p>https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&amp;blogId=demian7607&amp;logNo=222009975984</p>
      </li>
    </ul>
  </li>
  <li>np.vstack
    <ul>
      <li>ë‘ ë°°ì—´ì„ ìœ„ì—ì„œ ì•„ë˜ë¡œ ë¶™ì´ê¸°</li>
      <li><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimage-20220211200744146.png" alt="image-20220211200744146" /></li>
      <li>np.hstack
        <ul>
          <li>ë‘ ë°°ì—´ì„ ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë¶™ì´ê¸°</li>
        </ul>
      </li>
      <li>https://rfriend.tistory.com/352</li>
    </ul>
  </li>
  <li>StandardScaler.transform()
    <ul>
      <li>ì •ê·œí™” / í‘œì¤€í™” Standardization, z = (ğ‘¥-ğœ‡)/ğœ</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ê°œë³„ ì•„í‚¤í…ì²˜ì—ì„œ ì¶”ì¶œëœ ê¸°ëŠ¥ì˜ SVR RMSE ë²”ìœ„ëŠ” 17.56 ~ 18.52ì…ë‹ˆë‹¤.</p>

  <p>í•˜ì§€ë§Œ SVRì— ë§ì¶”ê¸° ì „ì— ì•„í‚¤í…ì²˜ ê¸°ëŠ¥ì„ ë‚˜ë€íˆ ìŒ“ìœ¼ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?</p>

  <p>ì¼ë¶€ ê¸°ëŠ¥ ì—°ê²° ë° í‘œì¤€í™”</p>

  <p>ëª¨ë“  K í´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ SVR Aë¥¼ ì¥ì°©í•©ë‹ˆë‹¤.
RMSEë¥¼ ì•½ê°„ ì¦ê°€ì‹œí‚¨ 85ì—ì„œ ëª©í‘œë¬¼ì„ í´ë¦½í•˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆì–´ìš”.</p>
</blockquote>

<blockquote>
  <p>ë˜í•œ 1.032ì˜ ìŠ¹ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ CVì™€ LBê°€ ëª¨ë‘ í–¥ìƒëœë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” SRVê°€ RMSEê°€ ì•„ë‹Œ í‰ê·  ì œê³± ì˜¤ì°¨ë¥¼ ìµœì í™”í•˜ê¸° ë•Œë¬¸ì¼ ìˆ˜ ìˆë‹¤.</p>
</blockquote>

<blockquote>
  <p>ì´ì œ ë‘ ë²ˆì§¸ feature ë¶€ë¶„ ì§‘í•©ì„ ì‚¬ìš©í•˜ì—¬ SVR Bë¥¼ ì¥ì°©í•©ë‹ˆë‹¤. ë” ë§ì€ í•˜ìœ„ ì§‘í•©ì„ ì í•©ì‹œí‚¤ëŠ” ì•„ì´ë””ì–´ëŠ” í›„ë°© ëª¨ë¸ ì•™ìƒë¸”ì— ë‹¤ì–‘ì„±ì„ ì¶”ê°€í•˜ê³  í˜•ìƒ ìˆ˜ë¥¼ ë„ˆë¬´ ë§ì´ ì¦ê°€ì‹œí‚¤ëŠ” ì°¨ì›ì„±ì˜ ì €ì£¼ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤.</p>
</blockquote>

<blockquote>
  <p>ì´ì œ ë”¥ ëŸ¬ë‹ ë¯¸ì„¸ ì¡°ì •ëœ ì´ë¯¸ì§€ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì¶”ë¡ ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">import</span> <span class="nn">albumentations</span> <span class="k">as</span> <span class="n">A</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'cuda'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s">"swin_large_patch4_window7_224"</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="s">"../input/petfinder-pawpularity-score"</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">base_dir</span>
    <span class="n">model_dir</span> <span class="o">=</span> <span class="s">"exp"</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">model_dir</span>
    <span class="n">img_test_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s">"test"</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="s">"swin_large_patch4_window7_224"</span>
    <span class="n">im_size</span> <span class="o">=</span>  <span class="mi">384</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>


<span class="k">class</span> <span class="nc">PetDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_filepaths</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">image_filepaths</span> <span class="o">=</span> <span class="n">image_filepaths</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">image_filepaths</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">image_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">image_filepaths</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_filepath</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">convert</span><span class="p">(</span><span class="s">'RGB'</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">image_rgb</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">)[</span><span class="s">"image"</span><span class="p">]</span>
        
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">/</span> <span class="mi">255</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">targets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>    


<span class="k">def</span> <span class="nf">get_inference_fixed_transforms</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">224</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># do not original aspects, colors and angles
</span>        <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">Compose</span><span class="p">([</span>
                <span class="n">A</span><span class="p">.</span><span class="n">SmallestMaxSize</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">A</span><span class="p">.</span><span class="n">CenterCrop</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
            <span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">Compose</span><span class="p">([</span>
                <span class="n">A</span><span class="p">.</span><span class="n">SmallestMaxSize</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="n">dim</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">A</span><span class="p">.</span><span class="n">CenterCrop</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">A</span><span class="p">.</span><span class="n">HorizontalFlip</span><span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PetNet</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">Config</span><span class="p">.</span><span class="n">model_path</span><span class="p">,</span>
        <span class="n">out_features</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">inp_channels</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">pretrained</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="p">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">in_chans</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>    


<span class="k">def</span> <span class="nf">tta_fn</span><span class="p">(</span><span class="n">filepaths</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">ttas</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Image Size:'</span><span class="p">,</span> <span class="n">Config</span><span class="p">.</span><span class="n">im_size</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>
    <span class="n">tta_preds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tta_mode</span> <span class="ow">in</span> <span class="n">ttas</span><span class="p">:</span><span class="c1">#range(Config.tta_times):
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'tta mode:</span><span class="si">{</span><span class="n">tta_mode</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
        <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">PetDataset</span><span class="p">(</span>
          <span class="n">image_filepaths</span> <span class="o">=</span> <span class="n">filepaths</span><span class="p">,</span>
          <span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filepaths</span><span class="p">)),</span>
          <span class="n">transform</span> <span class="o">=</span> <span class="n">get_inference_fixed_transforms</span><span class="p">(</span><span class="n">tta_mode</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">Config</span><span class="p">.</span><span class="n">im_size</span> <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">test_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
          <span class="n">test_dataset</span><span class="p">,</span>
          <span class="n">batch_size</span> <span class="o">=</span> <span class="n">Config</span><span class="p">.</span><span class="n">batch_size</span><span class="p">,</span>
          <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
          <span class="n">num_workers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
          <span class="n">pin_memory</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="p">)</span>
        <span class="c1">#stream = tqdm(test_loader)
</span>        <span class="n">tta_pred</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span><span class="c1">#enumerate(stream, start = 1):
</span>            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span> <span class="o">=</span> <span class="bp">True</span><span class="p">).</span><span class="nb">float</span><span class="p">()</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span> <span class="o">=</span> <span class="bp">True</span><span class="p">).</span><span class="nb">float</span><span class="p">().</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

            <span class="n">pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">output</span><span class="p">).</span><span class="n">detach</span><span class="p">().</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="n">ravel</span><span class="p">().</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">tta_pred</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="n">tta_preds</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">tta_pred</span><span class="p">))</span>
    
    <span class="n">fold_preds</span> <span class="o">=</span> <span class="n">tta_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tta_preds</span><span class="p">)):</span>
        <span class="n">fold_preds</span> <span class="o">+=</span> <span class="n">tta_preds</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">fold_preds</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tta_preds</span><span class="p">)</span>
        
    <span class="k">del</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">test_dataset</span>
    <span class="n">gc</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">empty_cache</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fold_preds</span>    
</code></pre></div></div>

<blockquote>
  <p>cuML SVR A, B, C ë° ì´ë¯¸ì§€ ëª¨ë¸ ì•™ìƒë¸”ì˜ OOF ì˜ˆì¸¡ì„ ì‚¬ìš©í•˜ì—¬ ì „ì²´ RMSEë¥¼ ìµœì í™”í•©ë‹ˆë‹¤.</p>
</blockquote>

<h2 id="oof-out-of-fold">OOF out of fold</h2>

<ul>
  <li>
    <p>ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ëŠ” ë°©ë²•</p>
  </li>
  <li>
    <p>OOF ë°©ì‹ì€ ì‹¤ë¬´ë³´ë‹¤ëŠ” Kaggle, Daconê³¼ ê°™ì€ ì˜ˆì¸¡ ì•Œê³ ë¦¬ì¦˜ ëŒ€íšŒì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ì´ë©° foldë¥¼ ì‚¬ìš©</p>
  </li>
  <li>
    <p>ë‘ê°€ì§€ ë°©ì‹</p>

    <ul>
      <li>Stacking
        <ul>
          <li>5 Fold ê¸°ë°˜ìœ¼ë¡œ ê°œë³„ ëª¨ë¸ì´ 5íšŒ ë²ˆê°ˆì•„ ê°€ë©´ 4/5 í•™ìŠµ ë°ì´í„°ë¡œ í•™ìŠµí•˜ê³ , 1/5 í•™ìŠµ ë°ì´í„°ë¡œ ì˜ˆì¸¡í•˜ì—¬ ë³„ë„ì˜ í•™ìŠµ ë°ì´í„°ë¥¼ ë§Œë“­ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ í•™ìŠµ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë©”íƒ€ ëª¨ë¸ì´(ì•„ë§ˆë„ Model 6) í•™ìŠµí•˜ì—¬ ìµœì¢… ì˜ˆì¸¡ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</li>
        </ul>
      </li>
      <li>ê°œë³„ ì˜ˆì¸¡ê°’ í‰ê· í•˜ëŠ” ë°©ë²•
        <ul>
          <li>K-Foldë¡œ í•™ìŠµì„ ìˆ˜í–‰ í•œ ë’¤ ì˜ˆì¸¡ì„ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— Kë²ˆ ë§Œí¼ ìˆ˜í–‰í•œ ë’¤ ê°œë³„ ì˜ˆì¸¡ê°’ì„ í‰ê· í•˜ì—¬ ìµœì¢… ì˜ˆì¸¡</li>
          <li><img src="D:%5CGithub%5CtistoryPostings%5Cartificial%20Intelligence%5Cimages%5Cpages%5Cimg.png" alt="img" /></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>https://techblog-history-younghunjo1.tistory.com/142</p>
  </li>
  <li>
    <p>ìœ„ ê·¸ë¦¼ì˜ ì¢Œì¸¡ì€ 4ê°œì˜ Foldë¡œ êµì°¨ê²€ì¦í•˜ëŠ” K=4 ì¼ë•Œì˜ K-fold êµì°¨ê²€ì¦ ë°©ë²•ì´ë‹¤. ì´ë ‡ê²Œ ì´ 4ë²ˆì˜ êµì°¨ê²€ì¦ìœ¼ë¡œ (ë™ì¼í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•œ) ì˜ˆì¸¡ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ê° ê²€ì¦ ë°ì´í„°ë¡œ í‰ê°€í•œ Model 1~4ë¥¼ ë§Œë“¤ì–´ë‚¸ë‹¤.(ì´ ë•Œ, Model 1,2,3,4ì—ì„œ ê°ê° ìµœì í™”ëœ íŒŒë¼ë¯¸í„° ê°’ë“¤ì€ ë‹¤ë¥¼ ê²ƒì´ë‹¤. ì™œëƒí•˜ë©´ ê° ëª¨ë¸ì´ í•™ìŠµí•œ ë°ì´í„°ê°€ ì„œë¡œ ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤.)</p>
  </li>
  <li>
    <p>ê·¸ë¦¬ê³  ë‚œ í›„, <strong>Model 1~4ë¥¼ ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ëŒ€í•´ ì˜ˆì¸¡</strong>í•˜ë„ë¡ í•˜ì—¬ ê° Model ë³„ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ëŒ€í•œ ì˜ˆì¸¡ê°’ì„ ê³„ì‚°í•œë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ìœ„ ê·¸ë¦¼ì—ì„œ ë…¸ë€ìƒ‰ ë°•ìŠ¤ì˜ Model 1~4 ì˜ˆì¸¡ê°’ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤.</p>

    <p>ë§ˆì§€ë§‰ìœ¼ë¡œ í•  ì¼ì€ <strong>ì´ 4ê°œì˜ ì˜ˆì¸¡ê°’ë“¤ì˜ í‰ê· ê°’ì„ ì·¨í•˜ì—¬ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ëŒ€í•œ ìµœì¢… ì˜ˆì¸¡ê°’ì„ ê³„ì‚°</strong>í•œë‹¤.</p>
  </li>
</ul>
:ET